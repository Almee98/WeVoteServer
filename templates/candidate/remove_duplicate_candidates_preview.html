{# templates/candidate/remove_duplicate_candidates_preview.html #}
{% extends "template_base.html" %}

{% block title %}Possible Duplicate Candidates{% endblock %}

{%  block content %}
{% load template_filters %}
{% load humanize %}
<style>
span.wrap_word { word-break: break-word; }
table, th, td {
  border: 1px solid lightgray;
  border-collapse: collapse;
}
th, td {
  padding: 3px;
}
</style>
{#<a href="{% url 'candidate:candidate_list' %}?google_civic_election_id={{ google_civic_election_id }}&state_code={{ state_code }}&page={{ page }}">#}
{#    < Back to Candidates</a>#}

<h1>
    Possible Duplicate Candidates
</h1>
{% if error_message %}<p><strong>{{ error_message }}</strong></p>{% endif %}


<form action="{% url 'candidate:remove_duplicate_candidates' %}" id="remove_duplicate_candidates" method="get" class="form-horizontal">
{% csrf_token %}

<input type="hidden" name="candidate_name" value="{{ candidate_name }}">
<input type="hidden" name="delete_submitted" value="1">
<input type="hidden" name="google_civic_election_id" value="{{ google_civic_election_id }}">
<input type="hidden" name="politician_we_vote_id" value="{{ politician_we_vote_id }}">
<input type="hidden" name="state_code" value="{{ state_code }}">

<p>
{% if politician_we_vote_id %}
    <a href="{% url 'politician:politician_we_vote_id_edit' politician_we_vote_id %}?google_civic_election_id={{ google_civic_election_id }}&state_code={{ state_code }}">
      cancel</a>
{% else %}
    <a href="{% url 'candidate:candidate_list' %}?google_civic_election_id={{ google_civic_election_id }}&state_code={{ state_code }}">
      cancel</a>
{% endif %}
</p>


{% if related_candidate_list %}
    <h4>Candidates That Might Match This Politician</h4>
    <table class="table">
        <tr>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>Candidate Name</td>
            <td>State</td>
            <td>Election</td>
            <td>Office</td>
            <td>Twitter Handle</td>
            <td>Website</td>
            <td>Id</td>
            <td>We Vote Ids</td>
            <td>Vote Smart Vote USA Id</td>
        </tr>
    {% for candidate in related_candidate_list %}
        <tr>
            <td>{{ forloop.counter }}</td>
            <td>
                {% if candidate.candidate_photo_url %}
                <a href="{% url 'candidate:candidate_edit' candidate.id %}?google_civic_election_id={{ google_civic_election_id }}" target="_blank">
                    <img src='{{ candidate.candidate_photo_url }}' height="48px" />
                </a>
                {% endif %}
            </td>
            <td><a href="{% url 'candidate:candidate_edit' candidate.id %}?google_civic_election_id={{ google_civic_election_id }}" target="_blank">{{ candidate.candidate_name }} <span class="glyphicon glyphicon-new-window"></span></a>
            &nbsp;
                <br />
                <span class="u-no-break">
                    <input type="checkbox"
                           {% if candidate.do_not_delete %}checked {% endif %}
                           name="do_not_delete_candidate_{{ candidate.id }}"
                           id="do_not_delete_candidate_{{ candidate.id }}_id"
                           value=1
                    />
                    do not delete
                </span>
            </td>
            <td>{{ candidate.get_candidate_state }}</td>
            <td>
                {{ candidate.election.election_name }} - {{ candidate.election.google_civic_election_id }}<br />
                {% if candidate.candidate_year %}Year: {{ candidate.candidate_year }}{% else %}{{ candidate.election.election_day_text }}{% endif %}
            </td>
            <td>
                {% if candidate.office %}
                        <a href="{% url 'office:office_summary' candidate.office.id %}" target="_blank">{{ candidate.office.office_name }} <span class="glyphicon glyphicon-new-window"></span></a>
                {% else %}
                    (office missing)
                {% endif %}
            </td>
            <td>{% if candidate.candidate_twitter_handle %}<a href="https://twitter.com/{{ candidate.candidate_twitter_handle }}"
                    target="_blank">{{ candidate.candidate_twitter_handle }}&nbsp;<span class="glyphicon glyphicon-new-window"></span></a><br />
                ({{ candidate.twitter_followers_count|intcomma }} followers){% endif %}</td>
            <td>
                {% if candidate.candidate_url %}<a href="{{ candidate.candidate_url }}" target="_blank">{{ candidate.candidate_url }} <span class="glyphicon glyphicon-new-window"></span></a>{% endif %}
                {% if candidate.candidate_contact_form_url %}<br /><a href="{{ candidate.candidate_contact_form_url }}" target="_blank">{{ candidate.candidate_contact_form_url }} <span class="glyphicon glyphicon-new-window"></span></a>{% endif %}
            </td>
            <td>{{ candidate.id }}</td>
            <td>{{ candidate.we_vote_id }}
                {% if candidate.politician_we_vote_id %}
                    {{ candidate.politician_we_vote_id }}
                {% else %}
                    ("pol"&nbsp;missing)
                {% endif %}
            </td>
            <td>
                {{ candidate.vote_smart_id|default_if_none:"" }}
                {{ candidate.vote_usa_politician_id|default_if_none:"" }}
            </td>
        </tr>
    {% endfor %}
    </table>
    <p>&nbsp;</p>
    <p>&nbsp;</p>
{% endif %}


<p>
{% if politician_we_vote_id %}
    <a href="{% url 'politician:politician_we_vote_id_edit' politician_we_vote_id %}?google_civic_election_id={{ google_civic_election_id }}&state_code={{ state_code }}">
      cancel</a>
{% else %}
    <a href="{% url 'candidate:candidate_list' %}?google_civic_election_id={{ google_civic_election_id }}&state_code={{ state_code }}">
      cancel</a>
{% endif %}
    <input name="submit_text" type="submit" value="Delete All" class="btn btn-danger" />
    &nbsp;
    &nbsp;
    <label for="confirm_delete_id">
        <input type="checkbox" name="confirm_delete" id="confirm_delete_id" value="1" /> Check to confirm that you want to permanently delete these candidates
    </label>

</p>
</form>

<br />
{% if candidate %}
<a href="{% url 'candidate:candidate_retrieve_photos' candidate.id %}">Retrieve photos (from Twitter, Vote Smart - TODO work in progress)</a>, <a href="{% url 'image:images_for_one_candidate' candidate.we_vote_id %}" target="_blank">See images (in new window)</a>,
    <a href="{% url 'import_export_twitter:delete_images_view'%}?candidate_id={{ candidate.id }}">Delete Cached Images</a><br />
    {% if candidate.candidate_photo_url %}
        <img src='{{ candidate.candidate_photo_url }}' />
        <br />
    {% endif %}

    {% if candidate.we_vote_hosted_profile_image_url_tiny %}
        we_vote_hosted_profile_image_url_tiny: {{ candidate.we_vote_hosted_profile_image_url_tiny }}<br />
        <img src="{{ candidate.we_vote_hosted_profile_image_url_tiny }}"><br />
        <br />
    {% endif %}

    {% if candidate.we_vote_hosted_profile_image_url_medium %}
        we_vote_hosted_profile_image_url_medium: {{ candidate.we_vote_hosted_profile_image_url_medium }}<br />
        <img src="{{ candidate.we_vote_hosted_profile_image_url_medium }}"><br />
        <br />
    {% endif %}

    {% if candidate.we_vote_hosted_profile_image_url_large %}
        we_vote_hosted_profile_image_url_large: <a href="{{ candidate.we_vote_hosted_profile_image_url_large }}" target="_blank">{{ candidate.we_vote_hosted_profile_image_url_large }}</a><br />
        <br />
    {% endif %}

    <p>&nbsp;</p>
    <p>&nbsp;</p>
    <p>&nbsp;</p>

    <h4>We Vote Positions Related to {{ candidate.candidate_name  }}</h4>
    {% if candidate.vote_smart_id %}
        <p><a href="{% url 'import_export_vote_smart:transfer_vote_smart_ratings_to_positions_for_candidate' candidate.id %}">Transfer Vote Smart Ratings to We Vote Positions</a></p>
    {% endif %}

        <p><a href="{% url 'organization:organization_list' %}?google_civic_election_id={{ google_civic_election_id }}&candidate_we_vote_id={{ candidate.we_vote_id }}" target="_blank">
            Add Position (start with Endorser taking the Position)</a> (open in new window)</p>

    <a name="positions"></a>
    {% if candidate_position_list %}
    <table class="table">
      <thead>
        <tr>
            <th></th>
            <th>Endorser Position</th>
            <th>Stance (w/ source)</th>
            <th>Election</th>
            <th>Election Date</th>
{#            <th>Rating Time Span</th>#}
        </tr>
      </thead>

        {% for candidate_position in candidate_position_list %}
        {% if not candidate_position.id %}
        <tr>
            <td colspan="3">
            (missing candidate_position.id)
            </td>
        </tr>
        {% else %}
        <tr>
            <td>{{ forloop.counter }}</td>
            <td>
                {% if candidate_position.organization_id %}
                <a href="{% url 'organization:organization_position_edit' candidate_position.organization_id candidate_position.we_vote_id %}">
                {{ candidate_position.organization.organization_name }} (edit position)</a>
                {% else %}
                    (not an org)
                {% endif %}
                {% if candidate_position.organization.twitter_followers_count %}
                    <br />
                    <span style="color: darkgray" class="u-no-break">(<i class="fa fa-twitter"></i> {{ candidate_position.organization.twitter_followers_count|intcomma }} Twitter Followers)</span>
                {% endif %}
            </td>
            <td>{{ candidate_position.get_stance_display }}
                {% if candidate_position.statement_text %}
                <span style="color: darkgray">{{ candidate_position.statement_text }}</span>
                {% endif %}
{#                {% if candidate_position.vote_smart_rating %} {{ candidate_position.vote_smart_rating }}%{% endif %}#}
                {% if candidate_position.more_info_url %}
                    <br />
                    <a href="{{ candidate_position.more_info_url }}"
                       target="_blank"
                       class="u-no-break"
                    >{{ candidate_position.more_info_url }} <span class="glyphicon glyphicon-new-window"></span></a>
                {% endif %}
            </td>
            <td>{{ candidate_position.election.google_civic_election_id }}</td>
            <td>{{ candidate_position.election.election_day_text }}</td>
{#            <td>{{ candidate_position.vote_smart_time_span|default_if_none:"" }}</td>#}
        </tr>
        {% endif %}
        {% endfor %}

        </table>
    {% else %}
        <p>(no positions found)</p>
    {% endif %}

    {% if candidate.vote_smart_id and candidate.vote_smart_id != False and candidate.vote_smart_id != 'False' and candidate.vote_smart_id != None and candidate.vote_smart_id != 'None' %}
        <h4>Vote Smart Ratings</h4>
        <p><a href="{% url 'import_export_vote_smart:import_one_candidate_ratings' candidate.vote_smart_id %}">Import Vote Smart Ratings for this Candidate</a></p>

        {% if rating_list %}
            <table border="1">
            <tr>
                <td></td>
                <td>ratingId</td>
                <td>sigId</td>
                <td>ratingName</td>
                <td>timeSpan</td>
                <td>candidateId</td>
                <td>rating</td>
            </tr>

            {% for special_interest_group_rating in rating_list %}
            <tr>
                <td>{{ forloop.counter }}</td>
                <td>{{ special_interest_group_rating.ratingId }}</td>
                <td><a href="{% url 'import_export_vote_smart:special_interest_group_rating_list' special_interest_group_rating.sigId %}" target="_blank">
                    {{ special_interest_group_rating.sigId }}</a></td>
                <td>{{ special_interest_group_rating.ratingName }}</td>
                <td>{{ special_interest_group_rating.timeSpan }}</td>
                <td>{{ special_interest_group_rating.candidateId }}</td>
                <td>{{ special_interest_group_rating.rating }}</td>
            </tr>
            {% endfor %}

            </table>
        {% else %}
            <p>(no special interest group ratings found)</p>
        {% endif %}
    {% endif %}{# End of if candidate.vote_smart_id #}
    <br />

    {% if candidate.twitter_profile_image_url_https_original %}
        <img src="{{ candidate.twitter_profile_image_url_https_original }}"><br />
        Twitter Image (Original)<br />
    {% endif %}

    {% if candidate.twitter_profile_banner_url_https %}
        <img src="{{ candidate.twitter_profile_banner_url_https }}"><br />
        Twitter Banner<br />
    {% endif %}
{% else %}

{# Only show other candidates running for this office when we are entering a new candidate #}
{% if candidate_list %}
<h5>Existing Candidates</h5>
    <table border="1" cellpadding="5" cellspacing="5">
        <tr>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>Candidate Name</td>
            <td>State</td>
            <td>Election</td>
            <td>Office</td>
            <td>Twitter Handle</td>
            <td>Website</td>
            <td>Id</td>
            <td>We Vote Id</td>
            <td>Vote Smart Id</td>
            <td>&nbsp;</td>
        </tr>
    {% for candidate in candidate_list %}
        <tr>
            <td>{{ forloop.counter }}</td>
            <td>
                {% if candidate.candidate_photo_url %}
                <a href="{% url 'candidate:candidate_edit' candidate.id %}">
                    <img src='{{ candidate.candidate_photo_url }}' height="48px" />
                </a>
                {% endif %}
            </td>
            <td><a href="{% url 'candidate:candidate_edit' candidate.id %}">{{ candidate.candidate_name }}</a></td>
            <td>{{ candidate.get_candidate_state }}</td>
            <td>{{ candidate.election.election_name }}</td>
            <td>
        {% if candidate.office and candidate.office.id %}
            <a href="{% url 'office:office_summary' candidate.office.id %}">{{ candidate.office.office_name }}</a>
        {% else %}
            (office missing)
        {% endif %}
            </td>
            <td>{% if candidate.candidate_twitter_handle %}<a href="https://twitter.com/{{ candidate.candidate_twitter_handle }}"
                    target="_blank"><i class="fa fa-twitter"></i> {{ candidate.candidate_twitter_handle }}</a><br />
                ({{ candidate.twitter_followers_count|intcomma }} followers){% endif %}</td>
            <td>{% if candidate.candidate_url %}<a href="{{ candidate.candidate_url }}" target="_blank">{{ candidate.candidate_url }}</a>{% endif %}</td>
            <td>{% if candidate.candidate_contact_form_url %}<a href="{{ candidate.candidate_contact_form_url }}" target="_blank">{{ candidate.candidate_contact_form_url }}</a>{% endif %}</td>
            <td>{{ candidate.id }}</td>
            <td>{{ candidate.we_vote_id }}
                {% if candidate.politician_we_vote_id %}
                    <a href="{% url 'politician:politician_we_vote_id_edit' candidate.politician_we_vote_id %}"
                       target="_blank">
                    {{ candidate.politician_we_vote_id }}
                    <span class="glyphicon glyphicon-new-window"></span></a>
                {% else %}
                    <a href="{% url 'candidate:candidate_politician_match' %}?candidate_we_vote_id=candidate.we_vote_id" target="_blank">Match to Politician  <span class="glyphicon glyphicon-new-window"></span></a>
                {% endif %}
            </td>
            <td>{{ candidate.vote_smart_id }}</td>
            <td><a href="{% url 'candidate:candidate_edit' candidate.id %}" style="font-size: .65em">(edit)</a></td>
        </tr>
    {% endfor %}
    </table>

    <p></p>
{% else %}
    {# Don't display anything if there aren't any other candidates captured for this office yet #}
{% endif %}

{% endif %}{# End of if candidate #}

<script>
    $(function() {
        $('#toggle_all_id').change(function() {
            var inputs = document.getElementsByName("select_for_marking_checks[]");
            for(var i = 0; i < inputs.length; i++) {
              if (inputs[i].checked === false) {
                inputs[i].checked = true;
              } else {
                inputs[i].checked = false;
              }
            }
        });
    });
</script>

<style>
    .animated {
        -webkit-transition: height 0.2s;
        -moz-transition: height 0.2s;
        transition: height 0.2s;
    }
</style>
<script>
    function hideElement(elementId) {
      var x = document.getElementById(elementId);
      x.style.display = "none";
    }
    function showElement(elementId) {
      var x = document.getElementById(elementId);
      x.style.display = "block";
    }
    $(function(){
        const { autosize } = window;
        autosize($('.normal'));
        autosize($('.animated'));
        $('#update_name_id').click(function(evt) {
          name = $('#hidden_name').text();
          $("input[name='candidate_name']").val(name);
          $('#update_name_id').prop('disabled', true).css('opacity',0.5);
        });

    }(window.$, window.autosize));

  // when you change the facebook url disable the button
  $(function() {
    $('#facebook_url_id').change(function() {
      console.log('txt fld changed');
      $('#facebook_a_tag').removeAttr('href').attr('type', 'button').attr('disabled');
      $('#facebook_a_tag').css('color', 'lightblue');
    });
  });
</script>


{% endblock %}
